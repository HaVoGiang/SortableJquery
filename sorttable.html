<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- <div class='span4'>
        <ol class='serialization vertical'>
            <li data-id="1" data-title="Thác Yang Bay" data-timestart="8" data-timein="2" data-timefree="0">
                <input type="text" name="LastName" value="Mouse">
            </li>
            <li data-id="2" data-title="Nhà thờ Núi (Nhà thờ chính tòa Kitô Vua)" data-timestart="10" data-timein="2"
                data-timefree="0">
            </li>
            <li data-id="3" data-title="Tháp Bà Ponagar" data-timestart="10" data-timein="2" data-timefree="0">
            </li>
            <li data-id="4" data-title="Biển Nha Trang" data-timestart="13" data-timein="2" data-timefree="0">
            </li>
            <li data-id="5" data-title="Nhà hát nghệ thuật dân gian Á Châu" data-timestart="15" data-timein="2"
                data-timefree="0">
            </li>
            <li data-id="6" data-title="XQ Sử Quán" data-timestart="18" data-timein="2" data-timefree="0">
            </li>
        </ol>
        <ol class='serialization vertical'>
            <li data-id="7" data-title="Thác Yang Bay" data-timestart="8" data-timein="2" data-timefree="0">
            </li>
            <li data-id="8" data-title="Nhà thờ Núi (Nhà thờ chính tòa Kitô Vua)" data-timestart="11" data-timein="2"
                data-timefree="0">
            </li>
            <li data-id="9" data-title="Tháp Bà Ponagar" data-timestart="16" data-timein="2" data-timefree="0">
            </li>
        </ol>
    </div> -->
    <div id="sort-table">

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"
        integrity="sha256-wS9gmOZBqsqWxgIVgA8Y9WcQOa7PgSIX+rPA0VL2rbQ=" crossorigin="anonymous"></script>
    <script src='js/jquery-sortable.js'></script>
    <!-- <script src="Sortable.js"></script> -->
    <script>
        var dataArr = [[{ "id": 1, "title": "Thác Yang Bay", "timestart": 8, "timein": 8, "timefree": 0 }, { "id": 2, "title": "Nhà thờ Núi (Nhà thờ chính tòa Kitô Vua)", "timestart": 10, "timein": 2, "timefree": 0 }, { "id": 3, "title": "Tháp Bà Ponagar", "timestart": 10, "timein": 2, "timefree": 0 }, { "id": 4, "title": "Biển Nha Trang", "timestart": 13, "timein": 2, "timefree": 0 }, { "id": 5, "title": "Nhà hát nghệ thuật dân gian Á Châu", "timestart": 15, "timein": 2, "timefree": 0 }, { "id": 6, "title": "XQ Sử Quán", "timestart": 18, "timein": 2, "timefree": 0 }], [{ "id": 7, "title": "Thác Yang Bay", "timestart": 8, "timein": 2, "timefree": 0 }, { "id": 8, "title": "Nhà thờ Núi (Nhà thờ chính tòa Kitô Vua)", "timestart": 11, "timein": 2, "timefree": 0 }, { "id": 9, "title": "Tháp Bà Ponagar", "timestart": 16, "timein": 2, "timefree": 0 }]];

        LoadData(dataArr);

        function CheckData(data) {
            var sum = 0;
            for (i = 0; i < data.length; i++) {
                for (j = 0; j < data[i].length; j++) {
                    sum += (data[i][j].timein + data[i][j].timefree);
                    if (sum > 21) {
                        alert("Không đủ thời gian trong ngày");
                        return false;
                    }
                }
                sum = 0;
            }
            return true;
        }
        function UpdateData(data) {
            dataArr = data;
        }
        function LoadData(data) {
            $('#sort-table').empty();
            for (i = 0; i < data.length; i++) {
                $('#sort-table').append("<ol class='serialization vertical olid"+ i +"'></ol>");
                for (j = 0; j < data[i].length; j++) {
                    $('.olid'+ i).append("<li data-id=\""+ data[i][j].id +"\" data-title=\""+ data[i][j].title +"\" data-timestart=\""+ data[i][j].timestart +"\" data-timein=\""+ data[i][j].timein +"\" data-timefree=\""+ data[i][j].timefree +"\">Nơi đến: " + data[i][j].title + ", Thời gian bắt đầu: <input class = \"txtTimeStart\" style=\"width: 40px;\" type=\"number\" value=\"" + data[i][j].timestart + "\">h, Thời gian lưu trú: <input class = \"txtTimeIn\" style=\"width: 40px;\" type=\"number\" value=\"" + data[i][j].timein + "\">h <button type=\"button\">Ok</button></li>");
                }
            }


            // for (i = 0; i < data.length; i++) {
            //     for (j = 0; j < data[i].length; j++) {
            //         //console.log(data[i][j]);
            //         txtResults = "Nơi đến: " + data[i][j].title + ", Thời gian bắt đầu: <input class = \"txtTimeStart\" style=\"width: 40px;\" type=\"number\" value=\"" + data[i][j].timestart + "\">h, Thời gian lưu trú: <input class = \"txtTimeIn\" style=\"width: 40px;\" type=\"number\" value=\"" + data[i][j].timein + "\">h <button type=\"button\">Ok</button>";
            //         $("li[data-id=" + data[i][j].id + "]").html(txtResults);
            //     }
            // }
        }
        function Refresh(){
            var group = $("ol.serialization").sortable({
                group: 'serialization',
                onDrop: function ($item, container, _super) {
                    var data = group.sortable("serialize").get();
                    console.log(dataArr);
                    if (CheckData(data)) {
                        UpdateData(data);
                    } else {
                        UpdateData(dataArr);
                        LoadData(dataArr);
                        Refresh();
                    }
                    _super($item, container);
                }

            });
        }
        $(document).ready(function () {
            Refresh();
            // var data = group.sortable("serialize").get();

            // CheckData(data);
            // LoadData(data);
        });
    </script>
</body>

</html>